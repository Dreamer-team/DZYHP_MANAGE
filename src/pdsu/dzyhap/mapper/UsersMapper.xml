<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="pdsu.dzyhap.dao.UsersMapper" >
  <resultMap id="BaseResultMap" type="pdsu.dzyhap.bean.Users" >
    <id column="user_id" property="userId" jdbcType="VARCHAR" />
    <result column="pwd" property="pwd" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="title" property="title" jdbcType="VARCHAR" />
    <result column="stat" property="stat" jdbcType="CHAR" />
  </resultMap>
  
  <resultMap type="pdsu.dzyhap.bean.Users" id="Dept_Users" extends="BaseResultMap">
    <association property="dept" column="deptId" javaType="pdsu.dzyhap.bean.Dept" resultMap="pdsu.dzyhap.dao.DeptMapper.BaseResultMap" > 
     </association>
  </resultMap>
  
  <sql id="base_sql"> user_id, pwd, name, title, dept_id, stat</sql>
  <delete id="deleteByPrimaryKey"  >
   
    delete from users
    where user_id = #{userId,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="pdsu.dzyhap.bean.Users" >
    
    insert into users (user_id, pwd, name, 
      title, dept_id, stat)
    values (#{userId,jdbcType=VARCHAR}, #{pwd,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR}, 
      #{title,jdbcType=VARCHAR}, #{dept.deptId,jdbcType=INTEGER}, #{stat,jdbcType=CHAR})
  </insert>
  <update id="updateByPrimaryKey" >
   
    update users
        <set>
            <if test="stat!=null &amp;&amp; stat !=''">  stat = #{stat,jdbcType=CHAR}</if>
        </set>
    where user_id = #{userId,jdbcType=VARCHAR}
  </update>
  <select id="selectByPrimaryKey" resultMap="Dept_Users"  >
    select  *
    from users u left join dept d on d.dept_id=u.dept_id
    where user_id = #{userId,jdbcType=VARCHAR}
  </select>
  <select id="selectAll" resultMap="Dept_Users" >
   select  *
    from users u left join dept d on d.dept_id=u.dept_id
  </select>
  
  
  <select id="login" resultType="pdsu.dzyhap.bean.Users">
     select <include refid="base_sql"></include>
    from users
    where pwd = #{pwd} and name=#{name}
  </select>
  
</mapper>